<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CapCut Downloader | SANN404 FORUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f172a; color: #f8fafc; }
        .neo-brutalism {
            border: 3px solid #000;
            box-shadow: 5px 5px 0px #000;
            transition: all 0.2s ease;
        }
        .neo-brutalism:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px #000; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div class="flex-grow container mx-auto px-4 py-12">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-black mb-4 uppercase tracking-tighter">
                CapCut <span class="text-yellow-400">Downloader</span>
            </h1>
            <p class="text-slate-400">Unduh video CapCut tanpa watermark dengan cepat</p>
        </header>

        <main class="max-w-2xl mx-auto">
            <div class="bg-white p-6 rounded-none neo-brutalism mb-8">
                <div class="flex flex-col md:flex-row gap-3">
                    <input type="text" id="urlInput" placeholder="Tempel link CapCut di sini..." 
                        class="flex-1 p-4 bg-slate-100 border-2 border-black text-black focus:outline-none">
                    <button onclick="fetchVideo()" id="btnFetch" 
                        class="bg-yellow-400 text-black font-bold py-4 px-8 border-2 border-black neo-brutalism hover:bg-yellow-500">
                        GET VIDEO
                    </button>
                </div>
            </div>

            <div id="loading" class="flex justify-center mb-8 hidden">
                <div class="loader"></div>
            </div>

            <div id="result" class="hidden animate-fade-in">
                <div class="bg-slate-800 border-2 border-black p-4 md:p-6 neo-brutalism">
                    <div class="flex flex-col md:flex-row gap-6">
                        <img id="thumb" src="" alt="Thumbnail" class="w-full md:w-48 h-auto border-2 border-black object-cover">
                        <div class="flex-1">
                            <h3 id="title" class="text-xl font-bold mb-4 text-yellow-400">Video Judul</h3>
                            <div class="grid grid-cols-1 gap-3">
                                <button onclick="downloadFile()" id="dlBtn"
                                    class="w-full bg-green-500 text-white font-bold py-3 border-2 border-black neo-brutalism flex items-center justify-center gap-2">
                                    <i class="fas fa-download"></i> DOWNLOAD SEKARANG
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <footer class="py-6 text-center border-t-2 border-black bg-slate-900 mt-auto">
        <p class="font-bold">Developed by <span class="text-yellow-400">SANN404 FORUM</span></p>
    </footer>

    <script>
        let videoUrl = "";

        async function fetchVideo() {
            const url = document.getElementById('urlInput').value;
            const resultDiv = document.getElementById('result');
            const loading = document.getElementById('loading');
            
            if(!url) return alert('Masukkan URL!');

            loading.classList.remove('hidden');
            resultDiv.classList.add('hidden');

            try {
                const response = await fetch('/api/download', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                
                if(data.status === true) {
                    document.getElementById('thumb').src = data.result.thumbnail;
                    document.getElementById('title').innerText = data.result.title || 'CapCut Video';
                    videoUrl = data.result.video; // Ambil URL video dari API
                    
                    resultDiv.classList.remove('hidden');
                } else {
                    alert('Gagal mengambil video. Pastikan link valid.');
                }
            } catch (err) {
                alert('Terjadi kesalahan koneksi.');
            } finally {
                loading.classList.add('hidden');
            }
        }

        // Fungsi download otomatis
        async function downloadFile() {
            if(!videoUrl) return;
            const btn = document.getElementById('dlBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = "Processing...";
            
            try {
                const res = await fetch(videoUrl);
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `CapCut_${Date.now()}.mp4`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            } catch (e) {
                // Fallback jika blob download gagal (CORS limit)
                window.open(videoUrl, '_blank');
            } finally {
                btn.innerHTML = originalText;
            }
        }
    </script>
</body>
</html>
